<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>Akenge Bootloader: Boot</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Akenge Bootloader
   &#160;<span id="projectnumber">1.0.3</span>
   </div>
   <div id="projectbrief">Custom bootloader for the Texas Instruments CC3200 MCU.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Boot</div>  </div>
</div><!--header-->
<div class="contents">

<p>Functions to read/write the boot.cfg file and load/run an image into SRAM.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:boot_8c"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="boot_8c.html">boot.c</a></td></tr>
<tr class="memdesc:boot_8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Implementation of the boot functions. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga3abf3cbaedc31179baaa6d5830a9334f"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___boot.html#ga3abf3cbaedc31179baaa6d5830a9334f">BOOTExistCfg</a> ()</td></tr>
<tr class="memdesc:ga3abf3cbaedc31179baaa6d5830a9334f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if boot.cfg exists.  <a href="#ga3abf3cbaedc31179baaa6d5830a9334f">More...</a><br /></td></tr>
<tr class="separator:ga3abf3cbaedc31179baaa6d5830a9334f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaac8d2c10eed2406483282c8636314aa2"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___boot.html#gaac8d2c10eed2406483282c8636314aa2">BOOTCreateCfg</a> ()</td></tr>
<tr class="memdesc:gaac8d2c10eed2406483282c8636314aa2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function used to create a new boot.cfg file.  <a href="#gaac8d2c10eed2406483282c8636314aa2">More...</a><br /></td></tr>
<tr class="separator:gaac8d2c10eed2406483282c8636314aa2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5ff99aa3fc7e20bff91d8b218d44042a"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___boot.html#ga5ff99aa3fc7e20bff91d8b218d44042a">BOOTDeleteCfg</a> ()</td></tr>
<tr class="memdesc:ga5ff99aa3fc7e20bff91d8b218d44042a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Removes the boot.cfg file from flash.  <a href="#ga5ff99aa3fc7e20bff91d8b218d44042a">More...</a><br /></td></tr>
<tr class="separator:ga5ff99aa3fc7e20bff91d8b218d44042a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9a3214b1ecc37c0fddc74e0f568b72b6"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___boot.html#ga9a3214b1ecc37c0fddc74e0f568b72b6">BOOTReadCfg</a> (<a class="el" href="structbootinfo__t.html">bootinfo_t</a> *bootinfo)</td></tr>
<tr class="memdesc:ga9a3214b1ecc37c0fddc74e0f568b72b6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads the boot.cfg file.  <a href="#ga9a3214b1ecc37c0fddc74e0f568b72b6">More...</a><br /></td></tr>
<tr class="separator:ga9a3214b1ecc37c0fddc74e0f568b72b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga448fcd46500c3a44bd2eb643865302be"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___boot.html#ga448fcd46500c3a44bd2eb643865302be">BOOTWriteCfg</a> (<a class="el" href="structbootinfo__t.html">bootinfo_t</a> *bootinfo)</td></tr>
<tr class="memdesc:ga448fcd46500c3a44bd2eb643865302be"><td class="mdescLeft">&#160;</td><td class="mdescRight">Writes the boot configuration.  <a href="#ga448fcd46500c3a44bd2eb643865302be">More...</a><br /></td></tr>
<tr class="separator:ga448fcd46500c3a44bd2eb643865302be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0cddb3d426efdd60c81b5c1ff48d7b03"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___boot.html#ga0cddb3d426efdd60c81b5c1ff48d7b03">BOOTLoadImg</a> (<a class="el" href="boot_8h.html#ad1f5dd072c562600d78c6f8789469bb3">imgtype_t</a> img)</td></tr>
<tr class="memdesc:ga0cddb3d426efdd60c81b5c1ff48d7b03"><td class="mdescLeft">&#160;</td><td class="mdescRight">Load an application image from the flash.  <a href="#ga0cddb3d426efdd60c81b5c1ff48d7b03">More...</a><br /></td></tr>
<tr class="separator:ga0cddb3d426efdd60c81b5c1ff48d7b03"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad363304370bf1ac14e570ace06118c52"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___boot.html#gad363304370bf1ac14e570ace06118c52">BOOTRun</a> (void *BaseAddr)</td></tr>
<tr class="memdesc:gad363304370bf1ac14e570ace06118c52"><td class="mdescLeft">&#160;</td><td class="mdescRight">Run an binary image from another location.  <a href="#gad363304370bf1ac14e570ace06118c52">More...</a><br /></td></tr>
<tr class="separator:gad363304370bf1ac14e570ace06118c52"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<h3>Overview</h3>
<p>In order to manage the boot process and firmware OTA update, the functions implemented here are needed.</p>
<p>The bootloader will search for a valid boot.cfg file in the root directory of the serial flash memory. This file is composed of a <a class="el" href="structbootinfo__t.html" title="Structure used in the boot.cfg file. ">bootinfo_t</a> structure that keeps the current boot status (as described in bootstatus_t) and the working image (factory or custom). The bootloader then uses this information to load and run the image.</p>
<p>OTA update must set the boot status to BOOT_CHECK and select the IMG_CUSTOM in order to validate the new firmware.</p>
<h3>Requires</h3>
<ul>
<li>Driverlib;</li>
<li>Simplelink (Can be the TINY build).</li>
</ul>
<h3>Usage</h3>
<p>First start the simplelink stack with an sl_Start(NULL, NULL, NULL) in order to access the serial flash memory. Then, use the desired functions.</p>
<h3>Example</h3>
<div class="fragment"><div class="line"><a class="code" href="structbootinfo__t.html">bootinfo_t</a> bootinfo;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Start NWP to get access to flash.</span></div>
<div class="line">sl_Start(NULL, NULL, NULL);</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="group___boot.html#ga3abf3cbaedc31179baaa6d5830a9334f">BOOTExistCfg</a>())</div>
<div class="line">{</div>
<div class="line">   <a class="code" href="group___boot.html#ga9a3214b1ecc37c0fddc74e0f568b72b6">BOOTReadCfg</a>(&amp;bootinfo);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Stop NWP.</span></div>
<div class="line">sl_Stop(0);</div>
</div><!-- fragment --><dl class="section author"><dt>Author</dt><dd>David Krepsky </dd></dl>
<dl class="section version"><dt>Version</dt><dd>1.0.1 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>01/2015 </dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>Akenge Engenharia</dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd><p class="startdd">Add support for secure files. </p>
<p>Load images different from custom.bin and factory.bin. </p>
<p class="enddd">Add ASSERT code to validate parameters.</p>
</dd></dl>
<dl class="bug"><dt><b><a class="el" href="bug.html#_bug000001">Bug:</a></b></dt><dd>None known. </dd></dl>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="gaac8d2c10eed2406483282c8636314aa2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t BOOTCreateCfg </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Creates a new boot.cfg file in the flash memory. This file max size will be 512 for a better use of the flash space. The created file is public to read and write.</p>
<dl class="section return"><dt>Returns</dt><dd>Returns the file handler if success. Returns the SL error otherwise.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>Only use this when <a class="el" href="group___boot.html#ga3abf3cbaedc31179baaa6d5830a9334f" title="Check if boot.cfg exists. ">BOOTExistCfg(void)</a> returns false. </dd></dl>

<p>Definition at line <a class="el" href="boot_8c_source.html#l00087">87</a> of file <a class="el" href="boot_8c_source.html">boot.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga5ff99aa3fc7e20bff91d8b218d44042a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t BOOTDeleteCfg </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function will delete the boot.cfg file from the serial flash. Useful when the file gets corrupted.</p>
<dl class="section warning"><dt>Warning</dt><dd>The current configuration will be deleted. Use with care. </dd></dl>

<p>Definition at line <a class="el" href="boot_8c_source.html#l00104">104</a> of file <a class="el" href="boot_8c_source.html">boot.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga3abf3cbaedc31179baaa6d5830a9334f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t BOOTExistCfg </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Uses the sl_FsGetInfo function to check whether boot.cfg exists in the flash memory;</p>
<dl class="section return"><dt>Returns</dt><dd>1 if the file exists, 0 otherwise. </dd></dl>

<p>Definition at line <a class="el" href="boot_8c_source.html#l00074">74</a> of file <a class="el" href="boot_8c_source.html">boot.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga0cddb3d426efdd60c81b5c1ff48d7b03"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t BOOTLoadImg </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="boot_8h.html#ad1f5dd072c562600d78c6f8789469bb3">imgtype_t</a>&#160;</td>
          <td class="paramname"><em>img</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function will load a custom firmware (custom.bin) or the factory firmware (factory.bin) in the SRAM at position BASE_ADDR, depending on the parameter img. </p>

<p>Definition at line <a class="el" href="boot_8c_source.html#l00170">170</a> of file <a class="el" href="boot_8c_source.html">boot.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga9a3214b1ecc37c0fddc74e0f568b72b6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t BOOTReadCfg </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structbootinfo__t.html">bootinfo_t</a> *&#160;</td>
          <td class="paramname"><em>bootinfo</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Reads the file from flash and stores it in the structure pointed by bootinfo.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">bootinfo</td><td>Structure to hold the boot.cfg file data.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, SL error code otherwise. </dd></dl>

<p>Definition at line <a class="el" href="boot_8c_source.html#l00112">112</a> of file <a class="el" href="boot_8c_source.html">boot.c</a>.</p>

</div>
</div>
<a class="anchor" id="gad363304370bf1ac14e570ace06118c52"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void BOOTRun </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>BaseAddr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function will use the interrupt vector of the application that will run to set the Stack Pointer Register (SP) and to find out the application entry point (which is the ResetISR pointer).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">BaseAddr</td><td>The application base address in the SRAM. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="boot_8c_source.html#l00217">217</a> of file <a class="el" href="boot_8c_source.html">boot.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga448fcd46500c3a44bd2eb643865302be"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t BOOTWriteCfg </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structbootinfo__t.html">bootinfo_t</a> *&#160;</td>
          <td class="paramname"><em>bootinfo</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Writes the boot.cfg file with the contents of the bootinfo structure.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">bootinfo</td><td>Structure that contains the boot.cfg file data.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, SL error code otherwise. </dd></dl>

<p>Definition at line <a class="el" href="boot_8c_source.html#l00137">137</a> of file <a class="el" href="boot_8c_source.html">boot.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Mar 17 2015 19:13:12 for Akenge Bootloader by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
